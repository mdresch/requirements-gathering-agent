# ADPA Troubleshooting Runbook for Developers and DevOps

**Generated by:** ADPA Enterprise Framework Automation v3.2.0  
**Category:** Implementation Guides  
**Generated:** 2025-01-13T00:00:00.000Z  
**Description:** Comprehensive troubleshooting guide for common ADPA issues and their resolutions

---

## Overview

This runbook provides step-by-step troubleshooting procedures for common issues encountered when developing with or deploying the ADPA (Advanced Document Processing & Automation) framework. It's designed for developers, DevOps engineers, and system administrators.

## Quick Diagnostic Commands

### System Health Check
```bash
# Check overall system status
adpa status

# Check specific components
adpa diagnose --config          # Configuration validation
adpa diagnose --dependencies    # Dependency health check
adpa diagnose --integrations    # Integration connectivity
adpa diagnose --performance     # Performance analysis

# API health check
curl -f http://localhost:3000/api/v1/health
```

### Log Analysis
```bash
# View recent logs
adpa logs --tail 100

# Filter by level
adpa logs --level error --since 1h

# Follow logs in real-time
adpa logs --follow

# Export logs for analysis
adpa logs --export --format json > logs.json
```

## Common Issues and Solutions

### 1. Installation and Setup Issues

#### Issue: NPM Installation Fails
**Symptoms:**
- `npm install` fails with permission errors
- Missing dependencies errors
- Node version compatibility issues

**Diagnosis:**
```bash
# Check Node.js version
node --version  # Should be >= 18.0.0

# Check npm version
npm --version

# Check permissions
npm config get prefix
```

**Solutions:**

1. **Fix Node.js Version:**
   ```bash
   # Install Node.js 18+ using nvm
   curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
   nvm install 18
   nvm use 18
   ```

2. **Fix NPM Permissions:**
   ```bash
   # Configure npm to use different directory
   mkdir ~/.npm-global
   npm config set prefix '~/.npm-global'
   echo 'export PATH=~/.npm-global/bin:$PATH' >> ~/.bashrc
   source ~/.bashrc
   ```

3. **Clear NPM Cache:**
   ```bash
   npm cache clean --force
   rm -rf node_modules package-lock.json
   npm install
   ```

#### Issue: Environment Configuration Problems
**Symptoms:**
- "API key not found" errors
- Configuration validation failures
- Environment variables not loading

**Diagnosis:**
```bash
# Check environment variables
adpa config list

# Validate configuration
adpa config validate

# Check .env file
cat .env | grep -v "^#" | grep -v "^$"
```

**Solutions:**

1. **Create Environment File:**
   ```bash
   # Copy template
   cp .env.example .env
   
   # Edit configuration
   nano .env
   ```

2. **Set Required Variables:**
   ```bash
   # Google AI
   export GOOGLE_AI_API_KEY="your_key_here"
   export GOOGLE_AI_MODEL="gemini-1.5-flash"
   
   # Azure OpenAI
   export AZURE_OPENAI_ENDPOINT="https://your-resource.openai.azure.com/"
   export AZURE_OPENAI_API_KEY="your_key_here"
   export DEPLOYMENT_NAME="gpt-4"
   
   # Set current provider
   export CURRENT_PROVIDER="google-ai"
   ```

3. **Validate Configuration:**
   ```bash
   adpa setup --validate-only
   ```

### 2. API and Service Issues

#### Issue: API Server Won't Start
**Symptoms:**
- Port already in use errors
- Database connection failures
- Module not found errors

**Diagnosis:**
```bash
# Check port usage
lsof -i :3000
netstat -tulpn | grep :3000

# Check database connection
adpa diagnose --database

# Check for missing modules
npm ls --depth=0
```

**Solutions:**

1. **Fix Port Conflicts:**
   ```bash
   # Kill process using port
   kill -9 $(lsof -ti:3000)
   
   # Or use different port
   export PORT=3001
   npm run api:start
   ```

2. **Fix Database Issues:**
   ```bash
   # Check database status
   systemctl status postgresql  # Linux
   brew services list | grep postgres  # macOS
   
   # Reset database connection
   adpa db:reset
   adpa db:migrate
   ```

3. **Reinstall Dependencies:**
   ```bash
   rm -rf node_modules package-lock.json
   npm install
   npm run build
   ```

#### Issue: API Requests Failing
**Symptoms:**
- 401 Unauthorized errors
- 429 Rate limit exceeded
- 500 Internal server errors
- Timeout errors

**Diagnosis:**
```bash
# Test API connectivity
curl -H "Authorization: Bearer your-api-key" \
     http://localhost:3000/api/v1/health

# Check API logs
adpa logs --service api --level error

# Test with verbose output
adpa generate project-charter --debug --verbose
```

**Solutions:**

1. **Fix Authentication:**
   ```bash
   # Verify API key
   adpa config get api-key
   
   # Regenerate API key
   adpa auth:refresh
   
   # Test authentication
   adpa auth:test
   ```

2. **Handle Rate Limiting:**
   ```bash
   # Use retry options
   adpa generate project-charter --retries 5 --retry-backoff 2000
   
   # Check rate limit status
   curl -I http://localhost:3000/api/v1/health
   ```

3. **Debug Internal Errors:**
   ```bash
   # Enable debug mode
   export DEBUG=adpa:*
   npm run api:start
   
   # Check error logs
   tail -f logs/error.log
   ```

### 3. Document Generation Issues

#### Issue: Document Generation Fails
**Symptoms:**
- AI provider errors
- Template not found errors
- Context validation failures
- Output format errors

**Diagnosis:**
```bash
# Test AI provider connection
adpa test-connection --provider google-ai

# List available templates
adpa list-templates

# Validate template
adpa validate-template project-charter

# Test with minimal context
adpa generate project-charter --context '{"projectName":"Test"}'
```

**Solutions:**

1. **Fix AI Provider Issues:**
   ```bash
   # Test different provider
   export CURRENT_PROVIDER=azure-openai
   adpa test-connection
   
   # Check API quotas
   adpa provider:status
   
   # Use fallback provider
   adpa generate project-charter --provider ollama
   ```

2. **Fix Template Issues:**
   ```bash
   # Update templates
   adpa templates:update
   
   # Validate template format
   adpa templates:validate project-charter
   
   # Use alternative template
   adpa generate project-management-plan
   ```

3. **Fix Context Issues:**
   ```bash
   # Use template with required context
   adpa generate project-charter \
     --context '{"projectName":"My Project","projectManager":"John Doe"}'
   
   # Get context requirements
   adpa template:info project-charter
   ```

#### Issue: Document Validation Fails
**Symptoms:**
- PMBOK compliance failures
- Quality score too low
- Missing required elements
- Cross-document inconsistencies

**Diagnosis:**
```bash
# Run comprehensive validation
adpa validate --comprehensive

# Check specific document
adpa validate --document project-charter.md

# Get validation details
adpa validate --verbose --output validation-report.json
```

**Solutions:**

1. **Fix PMBOK Compliance:**
   ```bash
   # Generate with PMBOK focus
   adpa generate project-charter --framework pmbok --compliance-mode strict
   
   # Use PMBOK template
   adpa generate project-charter --template pmbok-project-charter
   
   # Review compliance report
   cat generated-documents/compliance-report.md
   ```

2. **Improve Document Quality:**
   ```bash
   # Regenerate with quality focus
   adpa generate project-charter --quality-mode high
   
   # Use enhanced context
   adpa generate project-charter --context-file project-context.json
   
   # Review quality metrics
   adpa analyze --document project-charter.md
   ```

### 4. Integration Issues

#### Issue: Confluence Integration Fails
**Symptoms:**
- Authentication failures
- Space not found errors
- Permission denied errors
- Upload failures

**Diagnosis:**
```bash
# Test Confluence connection
adpa confluence test

# Check authentication status
adpa confluence auth:status

# Validate configuration
adpa confluence config:validate
```

**Solutions:**

1. **Fix Authentication:**
   ```bash
   # Re-authenticate
   adpa confluence auth:login
   
   # Check OAuth2 token
   adpa confluence auth:refresh
   
   # Use API token instead
   adpa confluence config:set --auth-type api-token
   ```

2. **Fix Permissions:**
   ```bash
   # Check user permissions
   adpa confluence user:permissions
   
   # Use different space
   adpa confluence publish --space-key DOCS
   
   # Create space if needed
   adpa confluence space:create --key PROJ --name "Project Documentation"
   ```

#### Issue: SharePoint Integration Fails
**Symptoms:**
- Microsoft Graph API errors
- Site not found errors
- File upload failures
- Permission issues

**Diagnosis:**
```bash
# Test SharePoint connection
adpa sharepoint test

# Check Graph API status
adpa sharepoint graph:status

# Validate site access
adpa sharepoint site:validate
```

**Solutions:**

1. **Fix Graph API Issues:**
   ```bash
   # Re-authenticate with Graph
   adpa sharepoint auth:login --scope sites.readwrite.all
   
   # Check tenant configuration
   adpa sharepoint tenant:info
   
   # Use different authentication method
   adpa sharepoint config:set --auth-type certificate
   ```

2. **Fix Site Access:**
   ```bash
   # List available sites
   adpa sharepoint sites:list
   
   # Use site URL instead of ID
   adpa sharepoint config:set --site-url "https://company.sharepoint.com/sites/project"
   
   # Check site permissions
   adpa sharepoint site:permissions
   ```

### 5. Performance Issues

#### Issue: Slow Document Generation
**Symptoms:**
- Long response times
- Timeouts
- High memory usage
- CPU spikes

**Diagnosis:**
```bash
# Monitor performance
adpa performance:monitor --duration 5m

# Profile generation
adpa generate project-charter --profile

# Check system resources
top -p $(pgrep -f "adpa")
```

**Solutions:**

1. **Optimize AI Provider:**
   ```bash
   # Use faster model
   export GOOGLE_AI_MODEL="gemini-1.5-flash"
   
   # Reduce context size
   adpa generate project-charter --context-limit 2000
   
   # Use local provider
   export CURRENT_PROVIDER=ollama
   ```

2. **Optimize System Resources:**
   ```bash
   # Increase memory limit
   export NODE_OPTIONS="--max-old-space-size=4096"
   
   # Use worker threads
   export WORKER_THREADS=4
   
   # Enable caching
   export ENABLE_CACHE=true
   ```

3. **Batch Operations:**
   ```bash
   # Generate multiple documents efficiently
   adpa generate-batch --templates project-charter,risk-register,stakeholder-register
   
   # Use parallel processing
   adpa generate-category pmbok --parallel 3
   ```

### 6. Docker and Container Issues

#### Issue: Docker Container Won't Start
**Symptoms:**
- Container exits immediately
- Port binding failures
- Volume mount issues
- Environment variable problems

**Diagnosis:**
```bash
# Check container logs
docker logs adpa-api

# Inspect container
docker inspect adpa-api

# Check port usage
docker port adpa-api
```

**Solutions:**

1. **Fix Container Configuration:**
   ```bash
   # Rebuild container
   docker-compose down
   docker-compose build --no-cache
   docker-compose up -d
   
   # Check environment variables
   docker exec adpa-api env | grep ADPA
   
   # Fix volume permissions
   sudo chown -R $USER:$USER ./data
   ```

2. **Fix Network Issues:**
   ```bash
   # Check network connectivity
   docker network ls
   docker network inspect adpa_default
   
   # Recreate network
   docker-compose down
   docker network prune
   docker-compose up -d
   ```

### 7. Database Issues

#### Issue: Database Connection Problems
**Symptoms:**
- Connection refused errors
- Authentication failures
- Migration failures
- Data corruption

**Diagnosis:**
```bash
# Test database connection
adpa db:test

# Check database status
adpa db:status

# Validate schema
adpa db:validate
```

**Solutions:**

1. **Fix Connection Issues:**
   ```bash
   # Check database service
   systemctl status postgresql
   
   # Test connection manually
   psql -h localhost -U adpa -d adpa_dev
   
   # Reset connection pool
   adpa db:pool:reset
   ```

2. **Fix Migration Issues:**
   ```bash
   # Run migrations
   adpa db:migrate
   
   # Rollback if needed
   adpa db:rollback
   
   # Reset database
   adpa db:reset --confirm
   ```

## Monitoring and Alerting

### Health Check Endpoints

```bash
# Basic health check
curl http://localhost:3000/api/v1/health

# Detailed health check
curl http://localhost:3000/api/v1/health/detailed

# Readiness check
curl http://localhost:3000/api/v1/health/ready

# Liveness check
curl http://localhost:3000/api/v1/health/live
```

### Metrics Collection

```bash
# Get system metrics
curl http://localhost:3000/api/v1/metrics

# Get performance metrics
curl http://localhost:3000/api/v1/metrics/performance

# Get error metrics
curl http://localhost:3000/api/v1/metrics/errors
```

### Log Analysis

```bash
# Search logs for errors
grep -i error logs/adpa.log | tail -20

# Analyze error patterns
awk '/ERROR/ {print $4}' logs/adpa.log | sort | uniq -c | sort -nr

# Monitor real-time errors
tail -f logs/adpa.log | grep ERROR
```

## Emergency Procedures

### Service Recovery

1. **Quick Restart:**
   ```bash
   # Stop all services
   adpa stop --all
   
   # Clear cache and temp files
   adpa clean --cache --temp
   
   # Restart services
   adpa start --all
   ```

2. **Database Recovery:**
   ```bash
   # Backup current state
   adpa db:backup --file emergency-backup.sql
   
   # Restore from backup
   adpa db:restore --file last-known-good.sql
   
   # Verify integrity
   adpa db:verify
   ```

3. **Configuration Reset:**
   ```bash
   # Backup current config
   cp .env .env.backup
   
   # Reset to defaults
   adpa config:reset
   
   # Reconfigure essentials
   adpa setup --quick
   ```

### Escalation Procedures

1. **Level 1 - Self-Service:**
   - Check this runbook
   - Review documentation
   - Search GitHub issues

2. **Level 2 - Community Support:**
   - Post in GitHub Discussions
   - Check Stack Overflow
   - Review community forums

3. **Level 3 - Professional Support:**
   - Create GitHub issue with logs
   - Contact enterprise support
   - Schedule support call

## Preventive Measures

### Regular Maintenance

```bash
# Weekly health check
adpa health:check --comprehensive

# Monthly dependency updates
npm audit fix
npm update

# Quarterly performance review
adpa performance:analyze --period 3months
```

### Monitoring Setup

```bash
# Set up log rotation
adpa logs:configure --rotate daily --keep 30

# Configure alerts
adpa alerts:configure --email admin@company.com --threshold error

# Set up backup schedule
adpa backup:schedule --daily --retention 30days
```

### Best Practices

1. **Environment Management:**
   - Use separate environments for dev/staging/prod
   - Version control configuration files
   - Regular backup of configurations

2. **Monitoring:**
   - Set up comprehensive logging
   - Monitor key metrics
   - Configure alerting for critical issues

3. **Documentation:**
   - Keep runbooks updated
   - Document custom configurations
   - Maintain incident logs

## Conclusion

This troubleshooting runbook provides comprehensive guidance for resolving common ADPA issues. Regular maintenance, proper monitoring, and following best practices will help prevent many issues from occurring.

For issues not covered in this runbook, please:
1. Check the latest documentation
2. Search existing GitHub issues
3. Create a new issue with detailed logs and reproduction steps

---

**Emergency Contact Information:**
- GitHub Issues: https://github.com/mdresch/requirements-gathering-agent/issues
- Documentation: https://docs.adpa.io
- Community: https://github.com/mdresch/requirements-gathering-agent/discussions